<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Barcode / QR</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="icon" href="icon.png" type="image/png" />
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
      }
      h1 {
        font-size: 28px;
        font-weight: bold;
      }
      .container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }
      .input-area,
      .code-display {
        border: 2px solid black;
        border-radius: 10px;
        padding: 10px;
        width: 400px;
        height: 400px;
        box-sizing: border-box;
        position: relative;
      }
      textarea {
        width: 100%;
        height: 100%;
        border: none;
        resize: none;
        font-size: 16px;
        padding: 10px;
        box-sizing: border-box;
        outline: none;
      }
      .code-display {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      svg {
        width: 80%;
        height: auto;
      }
      #qrContainer {
        display: none;
        width: 260px;
        height: 260px;
      }
      .barcode-text {
        margin-top: 10px;
        font-size: 18px;
        font-weight: bold;
      }
      .arrows {
        position: absolute;
        bottom: 10px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 20px;
      }
      .arrow {
        padding-left: 30px;
        padding-right: 30px;
        font-size: 40px;
        cursor: pointer;
        user-select: none;
      }
      footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        text-align: center;
        padding: 10px;
        background: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <h1 id="title">
      SỐ LƯỢNG MÃ
      <label style="font-size:16px; font-weight:normal; margin-left:10px;">
        <input type="checkbox" id="modeToggle" />
        QR code
      </label>
    </h1>
    <div class="container">
      <div class="input-area">
        <textarea
          id="barcodeInput"
          placeholder="Nhap ma - moi dong 1 ma"
        ></textarea>
      </div>
      <div class="code-display">
        <svg id="barcode"></svg>
        <div id="qrContainer"></div>
        <div class="barcode-text" id="barcodeText">Thông tin mã</div>
        <div class="arrows">
          <div class="arrow" onclick="prevBarcode()">&#x276E;</div>
          <div class="arrow" onclick="nextBarcode()">&#x276F;</div>
        </div>
      </div>
    </div>

    <script>
      let barcodes = [];
      let currentIndex = 0;

      const input = document.getElementById("barcodeInput");
      const barcodeEl = document.getElementById("barcode");
      const qrContainer = document.getElementById("qrContainer");
      const barcodeText = document.getElementById("barcodeText");
      const title = document.getElementById("title");
      const toggle = document.getElementById("modeToggle");

      const qrCode = new QRCode(qrContainer, {
        text: "",
        width: 260,
        height: 260,
        correctLevel: QRCode.CorrectLevel.M,
      });

      input.addEventListener("input", () => {
        barcodes = input.value
          .split(/\r?\n/)
          .map((x) => x.trim())
          .filter((x) => x !== "");
        currentIndex = 0;
        showCode();
      });

      toggle.addEventListener("change", () => {
        showCode();
      });

      function showCode() {
        const useQR = toggle.checked;
        if (barcodes.length === 0) {
          JsBarcode(barcodeEl, "", { displayValue: false });
          qrCode.clear();
          barcodeEl.style.display = useQR ? "none" : "block";
          qrContainer.style.display = useQR ? "block" : "none";
          barcodeText.textContent = "Thong tin ma";
          title.childNodes[0].textContent = "So luong ma";
          return;
        }
        const data = barcodes[currentIndex];
        if (useQR) {
          qrCode.clear();
          qrCode.makeCode(data);
          qrContainer.style.display = "block";
          barcodeEl.style.display = "none";
        } else {
          JsBarcode(barcodeEl, data, {
            format: "CODE128",
            displayValue: false,
            height: 100,
            width: 2,
          });
          barcodeEl.style.display = "block";
          qrContainer.style.display = "none";
        }
        barcodeText.textContent = data;
        title.childNodes[0].textContent = `So luong ma (${currentIndex + 1}/${
          barcodes.length
        })`;
      }

      function prevBarcode() {
        if (barcodes.length === 0) return;
        currentIndex = (currentIndex - 1 + barcodes.length) % barcodes.length;
        showCode();
      }

      function nextBarcode() {
        if (barcodes.length === 0) return;
        currentIndex = (currentIndex + 1) % barcodes.length;
        showCode();
      }

      window.addEventListener("DOMContentLoaded", () => {
        input.dispatchEvent(new Event("input"));
      });
    </script>
  </body>
  <footer>Ac 2025 Dinh Dau Moi</footer>
</html>
